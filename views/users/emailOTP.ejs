<%- include('header') %>

<div class="container">
    <br>
    <br>
    <br>

    <div class="row text-center">
        <br>
        <br>
        <br>
        <h4 class="">Verify OTP</h4>
        <br>
        <br>
    </div>

    <div class="row mt-5 justify-content-center">
        <div class="col-lg-6">
            <div class="container height-100 d-flex justify-content-center align-items-center">
                <div class="position-relative">
                    <div class="card p-2 text-center">
                        <h6>Please enter the one-time password <br><br> to verify your account</h6>
                        <br>
                        <div> <span>A code has been sent to your e-mail id</span> </div>
                        <br>

                        <form id="otpForm" action="/verify" method="post">
                            <div id="otp" class="inputs d-flex flex-row justify-content-center mt-2">
                                <input type="text" id="otpInput" name="otp" placeholder="Enter OTP" required>
                            </div>
                            <div id="errorMessage" style="color: red; display: none;">
                                 
                            </div>
                            <br>
                            <div class="mt-4">
                                <div>
                                    <p id="timer">Time remaining: 1:00</p>
                                    <p id="resendMessage"></p>
                                </div>
                                <a onclick="startResendTimer()" href="/Resendotp" id="resendButton" style="display: none;">Resend OTP</a>
                                <button type="submit" class="btn btn-primary px-4 validate" id="submitButton">Submit</button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Bootstrap Modal -->
                    <div class="modal fade" id="otpExpiredModal" tabindex="-1" aria-labelledby="otpExpiredModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="otpExpiredModalLabel">OTP Expired</h5>
                                </div>
                                <div class="modal-body">
                                    Your OTP has expired. Click the button to resend OTP.
                                </div>
                                <div class="modal-footer">
                                    <button type="button" onclick="startResendTimer()" class="btn btn-primary" id="resendButtonModal">Resend OTP</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  
    <script>
        var countdown;
        var resendCount = 0;
        var resendButton = document.getElementById('resendButton');
        var resendLink = document.getElementById('resendLink');

        // Start the timer on page load
        startTimer();

        function startTimer() {
            // Set the initial time to 60 seconds
            var time = 60;

            // Display the initial time
            displayTime(time);

            // Start the countdown
            countdown = setInterval(function () {
                time--;
                displayTime(time);

                // If the timer reaches 0, enable the "Resend OTP" button and show the message
                if (time <= 0) {
                    alert('hai')
                    clearInterval(countdown);
                    // resendButton.style.display = 'block';
                    // document.getElementById('resendMessage').innerText = 'You can now resend OTP.';
                    $('#otpExpiredModal').modal('show');

// Handle resend button click inside the modal
$('#resendButtonModal').on('click', function () {
  // Add your logic to resend OTP here
     $.ajax({
        method:'get',
        url:"/Resendotp",
        success:(responce)=>{
             if(responce.status){
              alert('successs resend otp')
                   }
                           
                }

     })
  

  // You may want to close the modal after resending
  $('#otpExpiredModal').modal('hide');
});
                    $.ajax({
                        method:'get',
                        url:"/expiryOTP",

                        success:(responce)=>{
                            if(responce.status){
                             alert('successs')
                            }
                           
                        }
                    })
                }
            }, 1000);
        }

        function startResendTimer() {
            // Hide the "Resend OTP" button until the resend limit is reached
            resendButton.style.display = 'none';

            // Reset the timer
            clearInterval(countdown);
            document.getElementById('resendMessage').innerText = '';

            // Start the timer again
            startTimer();

            // Increment the resend count
            resendCount++;

            // Show the "Resend OTP" button after the resend limit is reached
            if (resendCount < 3) {
                resendLink.style.display = 'block';
            } else {
                resendLink.style.display = 'none';
                document.getElementById('resendMessage').innerText = 'Resend limit reached.';
                resendCount = 0; // Reset resend count after the third attempt
            }
        }

        function validateForm() {
            // Add your OTP validation logic here

            // Example: Check if each OTP input is a number
            var otpInputs = document.querySelectorAll('.inputs input');
            for (var i = 0; i < otpInputs.length; i++) {
                if (isNaN(otpInputs[i].value)) {
                    alert('Please enter a valid OTP.');
                    return false;
                }
            }

            // Additional validation rules can be added as needed

            return true;
        }

        function displayTime(seconds) {
            var minutes = Math.floor(seconds / 60);
            var remainingSeconds = seconds % 60;

            // Add leading zero if seconds are less than 10
            remainingSeconds = remainingSeconds < 10 ? '0' + remainingSeconds : remainingSeconds;

            document.getElementById('timer').innerText = 'Time remaining: ' + minutes + ':' + remainingSeconds;
        }
    </script>

    <!-- Include Bootstrap JS and Popper.js -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <%- include('footer') %>